---
layout: post
title: Redis 网络模型
author: 求是君
categories: [Redis,  网络模型]
date: 2024-06-07 09:48 +0800
---

## 用户空间和内核态空间

为了避免用户应用导致冲突甚至内核崩溃，用户应用与内核是分离的：

- 进程的寻址空间会划分为两部分：**内核空间**、**用户空间**；

- 用户空间只能执行受限的命令（`Ring3`），而且不能直接调用系统资源，必须通过内核提供的接口来访问；
- 内核空间可以执行特权命令（`Ring0`），调用一切系统资源；

比如一个 32 位的操作系统，他的带宽就是 32，他的虚拟地址就是 2 的 32 次方，也就是说他寻址的范围就是 0 ~ 2 的 32 次方， 这片寻址空间对应的就是 2 的 32 个字节，就是 4GB，这个 4GB，会有 3 GB 分给用户空间，1GB 给内核系统；

<img src="../media/2024-06-07-redis-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/image-20240607214058068.png" alt="image-20240607214058068" style="zoom:50%;" />

Linux系统为了提高 IO 效率，会在用户空间和内核空间都加入缓冲区：

- 写数据时，要把用户缓冲数据拷贝到内核缓冲区，然后写入设备；

- 读数据时，要从设备读取数据到内核缓冲区，然后拷贝到用户缓冲区；

针对这个操作：我们的用户在写读数据时，会去向内核态申请，想要读取内核的数据，而内核数据要去等待驱动程序从硬件上读取数据，当从磁盘上加载到数据之后，内核会将数据写入到内核的缓冲区中，然后再将数据拷贝到用户态的 `buffer` 中，然后再返回给应用程序，整体而言，速度慢，就是这个原因，为了加速，我们希望 `read` 也好，还是 `wait for data` 也最好都不要等待，或者时间尽量的短。

<img src="../media/2024-06-07-redis-%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/image-20240607212500821.png" alt="image-20240607212500821" style="zoom:55%;" />

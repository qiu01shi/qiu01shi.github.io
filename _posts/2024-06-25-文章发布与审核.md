---
layout: post
title: 文章发布与审核
date: 2024-06-25 16:42 +0800
categories: [Blogging, TJU-news]
author: <author_id>
---

## 1. 文章数据流

如下图所示，文章发布主要分为以下几个步骤：

1. 在 `Media` 微服务发布文章，存入数据库中；异步调用文章审核方法；
2. 文章审核成功后，调用 `Article` 微服务保存文章，APP 端可以查看文章；

<img src="../media/2024-06-25-%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83%E4%B8%8E%E5%AE%A1%E6%A0%B8/image-20240625164534731.png" alt="image-20240625164534731" style="zoom:40%;" />



## 2. 自媒体文章自动审核流程

### 调用第三方接口审核



<img src="../media/2024-06-25-%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83%E4%B8%8E%E5%AE%A1%E6%A0%B8/image-20240625204545996.png" alt="image-20240625204545996" style="zoom:35%;" />



1. 自媒体端发布文章后，借助第三方接口审核文章的内容（文本内容和图片）；
2. 图片存储在 `MinIO` 中，需先下载再审核；
3. 审核失败，则需要修改自媒体文章的状态，`status: 2`  审核失败   `status: 3`  转到人工审核；
4. 审核成功，则需要在文章微服务中创建 `app` 端需要的文章；



### 自定义敏感词过滤

`DFA` 实现原理：

- `DFA`全称为：**Deterministic Finite Automaton**，即 **确定有穷自动机**。

- 存储：一次性的把所有的敏感词存储到了多个 `map` 中，就是下图表示这种结构；

- 敏感词：冰毒、大麻、大坏蛋。

isEnd —> 1 敏感词结尾；	isEnd —> 0 不是敏感词结尾；

<img src="../media/2024-06-25-%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83%E4%B8%8E%E5%AE%A1%E6%A0%B8/image-20240625205701594.png" alt="image-20240625205701594" style="zoom:45%;" />          <img src="../media/2024-06-25-%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83%E4%B8%8E%E5%AE%A1%E6%A0%B8/image-20240625205723013.png" alt="image-20240625205723013" style="zoom:25%;" />



检索流程如下图所示：

<img src="../media/2024-06-25-%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83%E4%B8%8E%E5%AE%A1%E6%A0%B8/image-20240625210054070.png" alt="image-20240625210054070" style="zoom:35%;" />

## 3. 文章详情

文章端创建 app 相关文章时，生成文章详情静态页上传到 MinIO 中：

<img src="../media/2024-06-25-%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83%E4%B8%8E%E5%AE%A1%E6%A0%B8/image-20240625211000830.png" alt="image-20240625211000830" style="zoom:33%;" />

具体实现如下图所示，将生成的 HTML 文件写入 MinIO 中，在 文章内容表的 URL 的字段中回写对应的 url 地址。

<img src="../media/2024-06-25-%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83%E4%B8%8E%E5%AE%A1%E6%A0%B8/image-20240625212248454.png" alt="image-20240625212248454" style="zoom:35%;" />



## 4. feign远程调用服务降级处理

<img src="../media/2024-06-25-%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83%E4%B8%8E%E5%AE%A1%E6%A0%B8/image-20240625211932193.png" alt="image-20240625211932193" style="zoom:40%;" />

- 服务降级是服务自我保护的一种方式，或者保护下游服务的一种方式，用于确保服务不会受请求突增影响变得不可用；
- 确保服务不会崩溃服务降级虽然会导致请求失败，但是不会导致阻塞。

---
layout: post
title: JVM 基础知识
date: 2024-07-08 19:37 +0800
categories: [Java, JVM]
author: <author_id>  
---

## 初识 JVM

### 什么是 JVM

JVM 全称是 Java Virtual Machine，中文译名 Java 虚拟机。

JVM 本质上是一个运行在计算机上的程序，他的职责是运行 Java 字节码文件。

Java源代码执行流程如下：

<img src="../media/2024-07-08-%E5%88%9D%E8%AF%86-jvm/image-20240708194335589.png" alt="image-20240708194335589" style="zoom:50%;" />

分为三个步骤：

1、编写Java源代码文件。

2、使用Java编译器（javac命令）将源代码编译成Java字节码文件。

3、使用Java虚拟机加载并运行Java字节码文件，此时会启动一个新的进程。



### JVM 的功能

**①  解释和运行**

对字节码文件中的指令，实时的解释成机器码，让计算机执行。

字节码文件中包含了字节码指令，计算器无法直接执行，Java虚拟机会将字节码文件中的字节码指令实时地解释成机器码，机器码是计算机可以运行的指令。

<img src="../media/2024-07-08-%E5%88%9D%E8%AF%86-jvm/1280X1280.PNG" alt="1280X1280" style="zoom:50%;" />



**②  内存管理**

- 自动为对象、方法等分配内存
- 自动的垃圾回收机制，回收不再使用的对象

Java虚拟机会帮助程序员为对象分配内存，同时将不用的对象使用垃圾回收器回收掉，这是对比C和C++这些语言的一个优势。在C/C++语言中，对象的回收需要程序员手动去编写代码完成，如果遗漏了这段删除对象的代码，这个对象就会永远占用内存空间，不会再回收。所以JVM的这个功能降低了程序员编写代码的难度。

**<font color='red'>③  即时编译 </font>**

对热点代码进行优化，提升执行效率。即时编译可以说是提升Java程序性能最核心的手段。



- Java 语言如果不做任何优化，性能不如C、C++等语言。

<img src="../media/2024-07-08-%E5%88%9D%E8%AF%86-jvm/image-20240708194857441.png" alt="image-20240708194857441" style="zoom:45%;" />

- Java需要实时解释，主要是为了支持跨平台特性。 Write Once，Run Anywhere 



<img src="../media/2024-07-08-%E5%88%9D%E8%AF%86-jvm/image-20240708195019757.png" alt="image-20240708195019757" style="zoom:45%;" />



虚拟机在运行过程中如果发现某一个方法甚至是循环是 **热点代码**（被非常高频调用），即时编译器会优化这段代码并将优化后的机器码 **保存在内存中**，如果第二次再去执行这段代码。Java虚拟机会将机器码从内存中取出来直接进行调用。这样节省了一次解释的步骤，同时执行的是优化后的代码，效率较高。

Java通过即时编译器获得了接近C/C++语言的性能，在某些特定的场景下甚至可以实现超越。

<img src="../media/2024-07-08-%E5%88%9D%E8%AF%86-jvm/image-20240708195108821.png" alt="image-20240708195108821" style="zoom:45%;" />



## 常见的 JVM

Java虚拟机规范

- 《Java虚拟机规范》由Oracle制定，内容主要包含了Java虚拟机在设计和实现时需要遵守的规范，主要包含class字节码文件的定义、类和接口的加载和初始化、指令集等内容。
- 《Java虚拟机规范》是对虚拟机设计的要求，而不是对Java设计的要求，也就是说虚拟机可以运行在其他的语言比如Groovy、Scala生成的class字节码文件之上。
- 官网地址：https://docs.oracle.com/javase/specs/index.html



平时我们最常用的，就是Hotspot虚拟机。

| 名称                       | 作者    | 支持版本                  | 社区活跃度（github star） | 特性                                                         | 适用场景                             |
| -------------------------- | ------- | ------------------------- | ------------------------- | ------------------------------------------------------------ | ------------------------------------ |
| HotSpot (Oracle JDK版)     | Oracle  | 所有版本                  | 高(闭源)                  | 使用最广泛，稳定可靠，社区活跃JIT支持Oracle JDK默认虚拟机    | 默认                                 |
| HotSpot (Open JDK版)       | Oracle  | 所有版本                  | 中(16.1k)                 | 同上开源，Open JDK默认虚拟机                                 | 默认对JDK有二次开发需求              |
| GraalVM                    | Oracle  | 11, 17,19企业版支持8      | 高（18.7k）               | 多语言支持高性能、JIT、AOT支持                               | 微服务、云原生架构需要多语言混合编程 |
| Dragonwell JDK龙井         | Alibaba | 标准版 8,11,17扩展版11,17 | 低(3.9k)                  | 基于OpenJDK的增强高性能、bug修复、安全性提升JWarmup、ElasticHeap、Wisp特性支持 | 电商、物流、金融领域对性能要求比较高 |
| Eclipse OpenJ9 (原 IBM J9) | IBM     | 8,11,17,19,20             | 低(3.1k)                  | 高性能、可扩展JIT、AOT特性支持                               | 微服务、云原生架构                   |

## 归纳总结

1、JVM到底是什么?

JVM 全称是 Java Virtual Machine，中文译名 Java虚拟机，是一个运行在计算机上的程序，他的职责是运行Java字节码文件。

2、JVM的三大核心功能是什么?

JVM 包含内存管理、解释执行虚拟机指令、即时编译三大功能。

3、常见的JVM虚拟机有哪些?

常见的JVM有HotSpot、GraalVM、OpenJ9等，另外DragonWell龙井JDK也 提供了一款功能增强版的JVM。其中使用最广泛的是HotSpot虚拟机。


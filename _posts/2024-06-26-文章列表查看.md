---
layout: post
title: 文章列表查看
date: 2024-06-26 12:51 +0800
categories: [TJU-news, 文章]
author: <author_id>  
---

## 文章列表加载

### 文章布局展示

<img src="../media/2024-06-26-%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E6%9F%A5%E7%9C%8B/image-20240626125828684.png" alt="image-20240626125828684" style="zoom:40%;" />



### 表结构分析

|     **表名称**     |           **说明**           |
| :----------------: | :--------------------------: |
|     ap_article     | 文章信息表，存储已发布的文章 |
| ap_article_config  |     APP已发布文章配置表      |
| ap_article_content |     APP已发布文章内容表      |
|     ap_author      |      APP文章作者信息表       |
|   ap_collection    |        APP收藏信息表         |

**`ap_article`  文章基本信息表：**

<img src="../media/2024-06-26-%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E6%9F%A5%E7%9C%8B/image-20240626130238730.png" alt="image-20240626130238730" style="zoom:40%;" />

**`ap_article_config`  文章配置表：**

<img src="../media/2024-06-26-%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E6%9F%A5%E7%9C%8B/image-20240626130340408.png" alt="image-20240626130340408" style="zoom:43%;" />

**`ap_article_content` 文章内容表：**

<img src="../media/2024-06-26-%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E6%9F%A5%E7%9C%8B/image-20240626130508552.png" alt="image-20240626130508552" style="zoom:45%;" />

**三张表关系分析：**

<img src="../media/2024-06-26-%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E6%9F%A5%E7%9C%8B/image-20240626130630830.png" alt="image-20240626130630830" style="zoom:40%;" />

- **对应的实体：**

`ap_article` 文章表对应实体：

```java
/**
 * <p>
 * 文章信息表，存储已发布的文章
 * </p>
 *
 * @author itheima
 */

@Data
@TableName("ap_article")
public class ApArticle implements Serializable {

    @TableId(value = "id",type = IdType.ID_WORKER)
    private Long id;


    /**
     * 标题
     */
    private String title;

    /**
     * 作者id
     */
    @TableField("author_id")
    private Long authorId;

    /**
     * 作者名称
     */
    @TableField("author_name")
    private String authorName;

    /**
     * 频道id
     */
    @TableField("channel_id")
    private Integer channelId;

    /**
     * 频道名称
     */
    @TableField("channel_name")
    private String channelName;

    /**
     * 文章布局  0 无图文章   1 单图文章    2 多图文章
     */
    private Short layout;

    /**
     * 文章标记  0 普通文章   1 热点文章   2 置顶文章   3 精品文章   4 大V 文章
     */
    private Byte flag;

    /**
     * 文章封面图片 多张逗号分隔
     */
    private String images;

    /**
     * 标签
     */
    private String labels;

    /**
     * 点赞数量
     */
    private Integer likes;

    /**
     * 收藏数量
     */
    private Integer collection;

    /**
     * 评论数量
     */
    private Integer comment;

    /**
     * 阅读数量
     */
    private Integer views;

    /**
     * 省市
     */
    @TableField("province_id")
    private Integer provinceId;

    /**
     * 市区
     */
    @TableField("city_id")
    private Integer cityId;

    /**
     * 区县
     */
    @TableField("county_id")
    private Integer countyId;

    /**
     * 创建时间
     */
    @TableField("created_time")
    private Date createdTime;

    /**
     * 发布时间
     */
    @TableField("publish_time")
    private Date publishTime;

    /**
     * 同步状态
     */
    @TableField("sync_status")
    private Boolean syncStatus;

    /**
     * 来源
     */
    private Boolean origin;

    /**
     * 静态页面地址
     */
    @TableField("static_url")
    private String staticUrl;
}
```

`ap_article_config`文章配置对应实体类：

```java
@Data
@TableName("ap_article_config")
public class ApArticleConfig implements Serializable {

    @TableId(value = "id",type = IdType.ID_WORKER)
    private Long id;

    /**
     * 文章id
     */
    @TableField("article_id")
    private Long articleId;

    /**
     * 是否可评论
     * true: 可以评论   1
     * false: 不可评论  0
     */
    @TableField("is_comment")
    private Boolean isComment;

    /**
     * 是否转发
     * true: 可以转发   1
     * false: 不可转发  0
     */
    @TableField("is_forward")
    private Boolean isForward;

    /**
     * 是否下架
     * true: 下架   1
     * false: 没有下架  0
     */
    @TableField("is_down")
    private Boolean isDown;

    /**
     * 是否已删除
     * true: 删除   1
     * false: 没有删除  0
     */
    @TableField("is_delete")
    private Boolean isDelete;
}
```

`ap_article_content` 文章内容对应的实体类：

```java
@Data
@TableName("ap_article_content")
public class ApArticleContent implements Serializable {

    @TableId(value = "id",type = IdType.ID_WORKER)
    private Long id;

    /**
     * 文章id
     */
    @TableField("article_id")
    private Long articleId;

    /**
     * 文章内容
     */
    private String content;
}
```



### 表的拆分

**垂直分表：**将一个表的字段分散到多个表中，每个表存储其中一部分字段。

**优势：**

1. 减少IO争抢，减少锁表的几率，查看文章概述与文章详情互不影响；
2. 充分发挥高频数据的操作效率，对文章概述数据操作的高效率不会被操作文章详情数据的低效率所拖累。

**拆分规则：**

1. 把不常用的字段单独放在一张表；
2. 把 `text`，`blob` 等大字段拆分出来单独放在一张表；
3. 经常组合查询的字段单独放在一张表中。



### 实现思路

1. 在默认频道展示10条文章信息；
2. 可以切换频道查看不同种类文章；
3. 当用户下拉可以加载最新的文章（分页），本页文章列表中发布时间为最大的时间为依据；
4. 当用户上拉可以加载更多的文章信息（按照发布时间），本页文章列表中发布时间最小的时间为依据；

<img src="../media/2024-06-26-%E6%96%87%E7%AB%A0%E5%88%97%E8%A1%A8%E6%9F%A5%E7%9C%8B/image-20240626131653428.png" alt="image-20240626131653428" style="zoom:45%;" />

5. 如果是当前频道的首页，前端传递默认参数：

- maxBehotTime：0（毫秒）

- minBehotTime：20000000000000（毫秒）--->2063年



### 接口定义

|          |     **加载首页**     |       **加载更多**       |      **加载最新**       |
| :------: | :------------------: | :----------------------: | :---------------------: |
| 接口路径 | /api/v1/article/load | /api/v1/article/loadmore | /api/v1/article/loadnew |
| 请求方式 |         POST         |           POST           |          POST           |
|   参数   |    ArticleHomeDto    |      ArticleHomeDto      |     ArticleHomeDto      |
| 响应结果 |    ResponseResult    |      ResponseResult      |     ResponseResult      |

`ArticleHomeDto`：

```java
@Data
public class ArticleHomeDto {

    // 最大时间
    Date maxBehotTime;
    // 最小时间
    Date minBehotTime;
    // 分页size
    Integer size;
    // 频道ID
    String tag;
}
```


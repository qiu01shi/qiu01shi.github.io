---
layout: post
title: Media端文章发布
date: 2024-06-26 22:11 +0800
categories: [Blogging,TJU-news]
author: <author_id>  
---

## 自媒体前后端搭建

### 后台搭建

**依赖关系：**

<img src="../media/2024-06-26-media%E7%AB%AF%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83/image-20240626221645876.png" alt="image-20240626221645876" style="zoom:40%;" />

在项目中分别创建对应的模块；

**Nacos 配置：**

`leadnews-wemedia`

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://localhost:3306/leadnews_wemedia?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC&useSSL=false
    username: ****
    password: ****
# 设置Mapper接口所对应的XML文件位置，如果你在Mapper接口中有自定义方法，需要进行该配置
mybatis-plus:
  mapper-locations: classpath*:mapper/*.xml
  # 设置别名包扫描路径，通过该属性可以给包中的类注册别名
  type-aliases-package: com.shawen.model.media.pojos
```

`leadnews-wemedia-gateway`

```yaml
spring:
  cloud:
    gateway:
      globalcors:
        cors-configurations:
          '[/**]': # 匹配所有请求
            allowedOrigins: "*" #跨域处理 允许所有的域
            allowedMethods: # 支持的方法
              - GET
              - POST
              - PUT
              - DELETE
      routes:
        # 平台管理
        - id: wemedia
          uri: lb://leadnews-wemedia
          predicates:
            - Path=/wemedia/**
          filters:
            - StripPrefix= 1
```



### 前台搭建

通过 `nginx` 的虚拟主机功能，使用同一个 `nginx` 访问多个项目。

<img src="../media/2024-06-26-media%E7%AB%AF%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83/image-20240626222408938.png" alt="image-20240626222408938" style="zoom:35%;" />

在 `nginx` 中 `leadnews.conf` 目录中新增 `TJU-campus-wemedia.conf` 文件

- 网关地址修改（localhost:51602）

- 前端项目目录修改（ wemedia-web 解压的目录）

- 访问端口修改(8802)

```nginx
upstream  heima-wemedia-gateway{
    server localhost:51602;
}

server {
	listen 8802;
	location / {
		root /Users/heshuwen/Documents/01_develop/myProjects/wemedia-web/;
		index index.html;
	}
	
	location ~/wemedia/MEDIA/(.*) {
		proxy_pass http://heima-wemedia-gateway/$1;
		proxy_set_header HOST $host;  # 不改变源请求头的值
		proxy_pass_request_body on;  #开启获取请求体
		proxy_pass_request_headers on;  #开启获取请求头
		proxy_set_header X-Real-IP $remote_addr;   # 记录真实发出请求的客户端IP
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  #记录代理信息
	}
}
```



## 自媒体素材管理

### 实现思路

**功能展示：**

<img src="../media/2024-06-26-media%E7%AB%AF%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83/image-20240626223448582.png" alt="image-20240626223448582" style="zoom:30%;" />

图片上传的页面，首先是展示素材信息，可以点击图片上传，弹窗后可以上传图片。



**流程图：**

<img src="../media/2024-06-26-media%E7%AB%AF%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83/image-20240626224055949.png" alt="image-20240626224055949" style="zoom:45%;" />

### 表结构

媒体图文素材信息表 `wm_material`

<img src="../media/2024-06-26-media%E7%AB%AF%E6%96%87%E7%AB%A0%E5%8F%91%E5%B8%83/image-20240626223735000.png" alt="image-20240626223735000" style="zoom:45%;" />

**对应实体类：**

```java
@Data
@TableName("wm_material")
public class WmMaterial implements Serializable {

    private static final long serialVersionUID = 1L;

    /**
     * 主键
     */
    @TableId(value = "id", type = IdType.AUTO)
    private Integer id;

    /**
     * 自媒体用户ID
     */
    @TableField("user_id")
    private Integer userId;

    /**
     * 图片地址
     */
    @TableField("url")
    private String url;

    /**
     * 素材类型
            0 图片
            1 视频
     */
    @TableField("type")
    private Short type;

    /**
     * 是否收藏
     */
    @TableField("is_collection")
    private Short isCollection;

    /**
     * 创建时间
     */
    @TableField("created_time")
    private Date createdTime;

}
```









